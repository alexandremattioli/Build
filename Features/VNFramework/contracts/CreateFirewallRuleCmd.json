{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vnf.example.com/schemas/CreateFirewallRuleCmd.json",
  "title": "CreateFirewallRuleCmd",
  "description": "Command to create a firewall rule on a VNF appliance via the broker",
  "type": "object",
  "required": ["interface", "direction", "action", "protocol"],
  "properties": {
    "ruleId": {
      "type": "string",
      "description": "Client-supplied idempotency key (optional); if provided, duplicate requests within 24h are deduplicated",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "interface": {
      "type": "string",
      "description": "Network interface name (e.g., 'wan', 'lan', 'opt1')",
      "minLength": 1,
      "maxLength": 32
    },
    "direction": {
      "type": "string",
      "enum": ["in", "out"],
      "description": "Traffic direction: 'in' for inbound, 'out' for outbound"
    },
    "action": {
      "type": "string",
      "enum": ["allow", "deny"],
      "description": "Firewall action: 'allow' to permit traffic, 'deny' to block"
    },
    "src": {
      "type": "object",
      "description": "Source address specification (cidr or alias)",
      "properties": {
        "cidr": {
          "type": "string",
          "description": "CIDR notation (e.g., '10.0.0.0/8', '192.168.1.0/24', 'any')",
          "pattern": "^(any|([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?)$"
        },
        "alias": {
          "type": "string",
          "description": "Alias name defined in the VNF (e.g., 'trusted_hosts')",
          "minLength": 1,
          "maxLength": 64
        }
      },
      "oneOf": [
        { "required": ["cidr"] },
        { "required": ["alias"] }
      ]
    },
    "dst": {
      "type": "object",
      "description": "Destination address specification (cidr or alias)",
      "properties": {
        "cidr": {
          "type": "string",
          "description": "CIDR notation (e.g., '10.0.0.0/8', '192.168.1.0/24', 'any')",
          "pattern": "^(any|([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?)$"
        },
        "alias": {
          "type": "string",
          "description": "Alias name defined in the VNF (e.g., 'dmz_servers')",
          "minLength": 1,
          "maxLength": 64
        }
      },
      "oneOf": [
        { "required": ["cidr"] },
        { "required": ["alias"] }
      ]
    },
    "protocol": {
      "type": "string",
      "enum": ["tcp", "udp", "icmp", "any"],
      "description": "IP protocol type"
    },
    "ports": {
      "type": "object",
      "description": "Port specifications for TCP/UDP protocols",
      "properties": {
        "src": {
          "type": "string",
          "description": "Source port or range (e.g., '80', '1024-65535', 'any')",
          "pattern": "^(any|[0-9]{1,5}(-[0-9]{1,5})?)$"
        },
        "dst": {
          "type": "string",
          "description": "Destination port or range (e.g., '443', '8000-8999', 'any')",
          "pattern": "^(any|[0-9]{1,5}(-[0-9]{1,5})?)$"
        }
      }
    },
    "description": {
      "type": "string",
      "description": "Human-readable rule description",
      "maxLength": 256
    },
    "enabled": {
      "type": "boolean",
      "description": "Whether the rule is active (default: true)",
      "default": true
    },
    "log": {
      "type": "boolean",
      "description": "Whether to log matches for this rule (default: false)",
      "default": false
    },
    "priority": {
      "type": "integer",
      "description": "Rule priority/sequence number (lower = higher priority); vendor-specific",
      "minimum": 0,
      "maximum": 99999
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "ruleId": "rule-allow-web-dmz",
      "interface": "wan",
      "direction": "in",
      "action": "allow",
      "src": { "cidr": "any" },
      "dst": { "alias": "web_servers_dmz" },
      "protocol": "tcp",
      "ports": { "dst": "443" },
      "description": "Allow HTTPS to DMZ web servers",
      "enabled": true,
      "log": true
    },
    {
      "interface": "lan",
      "direction": "out",
      "action": "deny",
      "src": { "cidr": "192.168.1.0/24" },
      "dst": { "cidr": "10.0.0.0/8" },
      "protocol": "any",
      "description": "Block LAN to private internal network",
      "enabled": true
    }
  ]
}
